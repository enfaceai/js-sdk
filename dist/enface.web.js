!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.Enface=r():e.Enface=r()}(this,(function(){return function(e){var r={};function n(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=r,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,r){if(1&r&&(e=n(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)n.d(t,o,function(r){return e[r]}.bind(null,o));return t},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="",n(n.s=2)}([function(e,r,n){"use strict";(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(r,"b",(function(){return o})),n.d(r,"a",(function(){return a})),n.d(r,"d",(function(){return i})),n.d(r,"e",(function(){return s})),n.d(r,"c",(function(){return u}));var o=[1],a={v1:{https:"https://api.enface.io/v1"}},i=10240,s=2e3,u="object"===(void 0===e?"undefined":t(e))&&"object"===t(e.versions)&&void 0!==e.versions.node}).call(this,n(1))},function(e,r){var n,t,o=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(r){try{return n.call(null,e,0)}catch(r){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{t="function"==typeof clearTimeout?clearTimeout:i}catch(e){t=i}}();var u,c=[],p=!1,f=-1;function d(){p&&u&&(p=!1,u.length?c=u.concat(c):f=-1,c.length&&l())}function l(){if(!p){var e=s(d);p=!0;for(var r=c.length;r;){for(u=c,c=[];++f<r;)u&&u[f].run();f=-1,r=c.length}u=null,p=!1,function(e){if(t===clearTimeout)return clearTimeout(e);if((t===i||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(e);try{t(e)}catch(r){try{return t.call(null,e)}catch(r){return t.call(this,e)}}}(e)}}function _(e,r){this.fun=e,this.array=r}function h(){}o.nextTick=function(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)r[n-1]=arguments[n];c.push(new _(e,r)),1!==c.length||p||s(l)},_.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=h,o.addListener=h,o.once=h,o.off=h,o.removeListener=h,o.removeAllListeners=h,o.emit=h,o.prependListener=h,o.prependOnceListener=h,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,r,n){"use strict";n.r(r),n.d(r,"createEnfaceApi",(function(){return b}));var t=n(0);function o(e,r,n,t,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?r(u):Promise.resolve(u).then(t,o)}var a=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)},i=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,n,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&Array.isArray(r)&&n===r.length){e.next=2;break}throw new Error("images array of length ".concat(n," required"));case 2:return e.abrupt("return",Promise.all(r.map((function(e,r){if(e instanceof Uint8Array&&(e=e.buffer),t.c&&!(e instanceof ArrayBuffer)||!t.c&&!(e instanceof ArrayBuffer||e instanceof File||e instanceof Blob))throw new Error("Bad image [".concat(r,"] format"));if(e instanceof ArrayBuffer&&e.byteLength<o||!t.c&&(e instanceof File||e instanceof Blob)&&e.size<o)throw new Error("image [".concat(r,"] is too small"));return t.c?e:new Blob([e],{type:"image/jpeg"})}))));case 3:case"end":return e.stop()}}),e)})),function(){var r=this,n=arguments;return new Promise((function(t,a){var i=e.apply(r,n);function s(e){o(i,t,a,s,u,"next",e)}function u(e){o(i,t,a,s,u,"throw",e)}s(void 0)}))});return function(e,n,t){return r.apply(this,arguments)}}(),s=function(e){return new Promise((function(r){return setTimeout(r,e)}))};function u(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],t=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(t=(i=s.next()).done)&&(n.push(i.value),!r||n.length!==r);t=!0);}catch(e){o=!0,a=e}finally{try{t||null==s.return||s.return()}finally{if(o)throw a}}return n}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return c(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function p(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function f(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?p(Object(n),!0).forEach((function(r){_(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function d(e,r,n,t,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?r(u):Promise.resolve(u).then(t,o)}function l(e){return function(){var r=this,n=arguments;return new Promise((function(t,o){var a=e.apply(r,n);function i(e){d(a,t,o,i,s,"next",e)}function s(e){d(a,t,o,i,s,"throw",e)}i(void 0)}))}}function _(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var h=function e(r){var n=this,o=r.apiUrl,a=r.token;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),_(this,"_request",function(){var e=l(regeneratorRuntime.mark((function e(r){var t,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.uri,o=r.post,console.log("[EnfaceApi.request] to ".concat(n.apiUrl).concat(t)),e.next=4,fetch("".concat(n.apiUrl).concat(t),{method:"post",body:o,headers:o instanceof FormData?o.getHeaders():{"Content-Type":"application/json","Content-Length":o.length}});case 4:return a=e.sent,e.prev=5,e.next=8,a.text();case 8:if(i=e.sent,"error"!==(a=JSON.parse(i)).status){e.next=13;break}return console.error("[EnfaceApi.request] error response",i),e.abrupt("return",i);case 13:return e.abrupt("return",a);case 16:throw e.prev=16,e.t0=e.catch(5),console.error("[EnfaceApi.request] bad response",i),new Error("Bad response: ".concat(e.t0));case 20:case"end":return e.stop()}}),e,null,[[5,16]])})));return function(r){return e.apply(this,arguments)}}()),_(this,"_process",function(){var e=l(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t instanceof FormData?t.append("token",n.token):t=JSON.stringify(f(f({},t),{},{token:n.token})),e.next=4,n._request({uri:r,post:t});case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(0),console.error("[EnfaceApi.request] failed",e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,n){return e.apply(this,arguments)}}()),_(this,"_checkImages",function(){var e=l(regeneratorRuntime.mark((function e(r,n,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Array.isArray(r)||(r=[r]),e.next=4,i(r,n,t);case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(0),console.error("[EnfaceApi.checkImages]",e.t0),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,n,t){return e.apply(this,arguments)}}()),_(this,"detect",function(){var e=l(regeneratorRuntime.mark((function e(r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._checkImages(r.images,1,t.d);case 2:if(r.images=e.sent,r.images){e.next=5;break}return e.abrupt("return");case 5:return o=new FormData,r.bbox&&o.append("bbox","true"),r.bbox_pro&&o.append("bbox_pro","true"),r.multi&&o.append("multi","true"),r.feature_check&&r.feature_check.forEach((function(e){return o.append("feature_check",e)})),r.thumb&&o.append("thumb","true"),r.images.forEach((function(e,r){return o.append("images",e,"".concat(r,".jpg"))})),e.abrupt("return",n._process("/detect",o));case 13:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),_(this,"compare",function(){var e=l(regeneratorRuntime.mark((function e(r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._checkImages(r.images,1,t.d);case 2:if(r.images=e.sent,r.images){e.next=5;break}return e.abrupt("return");case 5:return o=new FormData,r.bbox&&o.append("bbox","true"),r.bbox_pro&&o.append("bbox_pro","true"),r.bbox_real&&o.append("bbox_real","true"),r.multi&&o.append("multi","true"),r.feature_check&&r.feature_check.forEach((function(e){return o.append("feature_check",e)})),r.thumb&&o.append("thumb","true"),r.threshold&&o.append("threshold",r.threshold),r.images.forEach((function(e,r){return o.append("images",e,"".concat(r,".jpg"))})),e.abrupt("return",n._process("/compare",o));case 15:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),_(this,"personSearch",function(){var e=l(regeneratorRuntime.mark((function e(r){var o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._checkImages(r.image,1,t.d);case 2:if(o=e.sent){e.next=5;break}return e.abrupt("return");case 5:return a=u(o,1),r.image=a[0],i=new FormData,r.new_person_threshold&&i.append("new_person_threshold",r.new_person_threshold),r.new_person_square_min&&i.append("new_person_square_min",r.new_person_square_min),r.new_person_yaw_max&&i.append("new_person_yaw_max",r.new_person_yaw_max),r.person_list_search&&i.append("person_list_search",r.person_list_search),r.person_list_add&&i.append("person_list_add",r.person_list_add),r.group_id&&i.append("group_id",r.group_id),r.source_id&&i.append("source_id",r.source_id),r.thumb&&i.append("thumb","true"),r.bbox&&i.append("bbox","true"),r.bbox_pro&&i.append("bbox_pro","true"),r.multi&&i.append("multi","true"),r.feature_check&&r.feature_check.forEach((function(e){return i.append("feature_check",e)})),r.normalized&&i.append("normalized","true"),r.drop_image&&i.append("drop_image","true"),i.append("results",r.results||1),i.append("image",r.image,"0.jpg"),e.abrupt("return",n._process("/action",i));case 25:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),_(this,"personCreate",function(){var e=l(regeneratorRuntime.mark((function e(r){var o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._checkImages(r.image,1,t.d);case 2:if(o=e.sent){e.next=5;break}return e.abrupt("return");case 5:return a=u(o,1),r.image=a[0],i=new FormData,r.new_person_threshold&&i.append("new_person_threshold",r.new_person_threshold),r.new_person_square_min&&i.append("new_person_square_min",r.new_person_square_min),r.new_person_yaw_max&&i.append("new_person_yaw_max",r.new_person_yaw_max),r.list_id&&i.append("list_id",r.list_id),r.replace_person_id&&i.append("replace_person_id",r.replace_person_id),r.fields&&r.fields.forEach((function(e){return i.append("fields",e)})),r.feature_check&&r.feature_check.forEach((function(e){return i.append("feature_check",e)})),r.multi&&i.append("multi","true"),r.normalized&&i.append("normalized","true"),r.drop_image&&i.append("drop_image","true"),r.bbox&&i.append("bbox","true"),r.bbox_pro&&i.append("bbox_pro","true"),r.thumb&&i.append("thumb","true"),i.append("image",r.image,"0.jpg"),e.abrupt("return",n._process("/person/create",i));case 23:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),_(this,"tokenCreate",(function(e){var r={};return e.valid_days&&(r.valid_days=e.valid_days),e.expires&&(r.expires=e.expires),n._process("/token/create",r)})),_(this,"tokenDelete",(function(e){return n._process("/token/delete",{token_id:e.token_id})})),_(this,"tokenUpdate",(function(e){var r={};return e.valid_days&&(r.valid_days=e.valid_days),e.expires&&(r.expires=e.expires),n._process("/token/update",f({token_id:e.token_id},r))})),_(this,"sourceGroupCreate",(function(e){var r={};return e.person_list_search&&(r.person_list_search=e.person_list_search),n._process("/source/group/create",f({name:e.name},r))})),_(this,"sourceGroupDelete",(function(e){return n._process("/source/group/delete",{group_id:e.group_id})})),_(this,"sourceGroupUpdate",(function(e){var r={};return e.name&&(r.name=e.name),e.person_list_search&&(r.person_list_search=e.person_list_search),n._process("/source/group/update",f({group_id:e.group_id},r))})),_(this,"sources",(function(e){return n._process("/sources",{group_id:e.group_id})})),_(this,"sourceCreate",(function(e){var r={};return e.new_person_threshold&&(r.new_person_threshold=e.new_person_threshold),e.new_person_square_min&&(r.new_person_square_min=e.new_person_square_min),e.new_person_yaw_max&&(r.new_person_yaw_max=e.new_person_yaw_max),e.person_list_add&&(r.person_list_add=e.person_list_add),e.feature_check&&(r.feature_check=e.feature_check),n._process("/source/create",f({group_id:e.group_id,name:e.name},r))})),_(this,"sourceDelete",(function(e){return n._process("/source/delete",{group_id:e.group_id,source_id:e.source_id})})),_(this,"sourceUpdate",(function(e){var r={};return e.name&&(r.name=e.name),e.new_person_threshold&&(r.new_person_threshold=e.new_person_threshold),e.new_person_square_min&&(r.new_person_square_min=e.new_person_square_min),e.new_person_yaw_max&&(r.new_person_yaw_max=e.new_person_yaw_max),e.person_list_add&&(r.person_list_add=e.person_list_add),e.feature_check&&(r.feature_check=e.feature_check),n._process("/source/update",f({group_id:e.name,source_id:e.source_id},r))})),_(this,"person",(function(e){return n._process("/person",{list_id:e.list_id,person_id:e.person_id})})),_(this,"personLists",(function(){return n._process("/person/lists",{})})),_(this,"personListCreate",(function(e){return n._process("/person/list/create",{name:e.name})})),_(this,"personListDelete",(function(e){var r={};return e.list_id&&(r.list_id=e.list_id),e.name&&(r.name=e.name),n._process("/person/list/delete",f({},r))})),_(this,"personListUpdate",(function(e){return n._process("/person/list/update",{list_id:e.list_id,name:e.name})})),_(this,"personDelete",(function(e){var r={};return e.list_id&&(r.list_id=e.list_id),n._process("/person/delete",f({person_id:e.person_id},r))})),_(this,"personUpdate",(function(e){var r={};return e.list_id&&(r.list_id=e.list_id),e.fields&&(r.fields=e.fields),e.drop_image&&(r.drop_image=e.drop_image),n._process("/person/update",f({person_id:e.person_id},r))})),_(this,"facesOnImageCount",function(){var e=l(regeneratorRuntime.mark((function e(r){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.apiDetect({images:r.images,bbox:!0,multi:!0});case 2:return t=e.sent,e.abrupt("return",t.results&&Array.isArray(t.results)&&Array.isArray(t.results[0])?t.results[0].length:0);case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),_(this,"guaranteed",function(){var e=l(regeneratorRuntime.mark((function e(r,n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=null;case 1:return e.prev=1,e.next=4,r(n);case 4:o=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),e.next=11,s(t.e);case 11:if(null===o){e.next=1;break}case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(r,n){return e.apply(this,arguments)}}()),this.apiUrl=o,this.token=a},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.version,n=void 0===r?t.b[t.b.length-1]:r,o=e.token,i=e.url;if(!a(o))throw new Error("Bad API key format");if(!i){if(n=+n,!t.b.includes(n))throw new Error("You have specified a non-existent version of Enface API: ".concat(n,". Available versions: ").concat(t.b.join(", ")));i=t.a["v".concat(n)].https}return new h({token:o,apiUrl:i})};t.c||(window.createEnfaceApi=m);var b=m}])}));