!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.Enface=r():e.Enface=r()}(this,(function(){return function(e){var r={};function n(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=r,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,r){if(1&r&&(e=n(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)n.d(t,o,function(r){return e[r]}.bind(null,o));return t},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="",n(n.s=0)}([function(e,r,n){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.r(r),n.d(r,"createEnfaceApi",(function(){return w}));var o=[1],a={v1:{https:"https://api.enface.io/v1"}},s="object"===("undefined"==typeof process?"undefined":t(process))&&"object"===t(process.versions)&&void 0!==process.versions.node;function i(e,r,n,t,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void n(e)}i.done?r(u):Promise.resolve(u).then(t,o)}var u=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)},c=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,n,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&Array.isArray(r)&&n===r.length){e.next=2;break}throw new Error("images array of length ".concat(n," required"));case 2:return e.abrupt("return",Promise.all(r.map((function(e,r){if(e instanceof Uint8Array&&(e=e.buffer),s&&!(e instanceof ArrayBuffer)||!s&&!(e instanceof ArrayBuffer||e instanceof File||e instanceof Blob))throw new Error("Bad image [".concat(r,"] format"));if(e instanceof ArrayBuffer&&e.byteLength<t||!s&&(e instanceof File||e instanceof Blob)&&e.size<t)throw new Error("image [".concat(r,"] is too small"));return s?e:new Blob([e],{type:"image/jpeg"})}))));case 3:case"end":return e.stop()}}),e)})),function(){var r=this,n=arguments;return new Promise((function(t,o){var a=e.apply(r,n);function s(e){i(a,t,o,s,u,"next",e)}function u(e){i(a,t,o,s,u,"throw",e)}s(void 0)}))});return function(e,n,t){return r.apply(this,arguments)}}(),p=function(e){return new Promise((function(r){return setTimeout(r,e)}))};function f(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],t=!0,o=!1,a=void 0;try{for(var s,i=e[Symbol.iterator]();!(t=(s=i.next()).done)&&(n.push(s.value),!r||n.length!==r);t=!0);}catch(e){o=!0,a=e}finally{try{t||null==i.return||i.return()}finally{if(o)throw a}}return n}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return _(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function d(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?d(Object(n),!0).forEach((function(r){b(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function m(e,r,n,t,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void n(e)}i.done?r(u):Promise.resolve(u).then(t,o)}function h(e){return function(){var r=this,n=arguments;return new Promise((function(t,o){var a=e.apply(r,n);function s(e){m(a,t,o,s,i,"next",e)}function i(e){m(a,t,o,s,i,"throw",e)}s(void 0)}))}}function b(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var g=function e(r){var n=this,t=r.apiUrl,o=r.token;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"_request",function(){var e=h(regeneratorRuntime.mark((function e(r){var t,o,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.uri,o=r.post,console.log("[EnfaceApi.request] to ".concat(n.apiUrl).concat(t)),e.next=4,fetch("".concat(n.apiUrl).concat(t),{method:"post",body:o,headers:o instanceof FormData?o.getHeaders():{"Content-Type":"application/json","Content-Length":o.length}});case 4:return a=e.sent,e.prev=5,e.next=8,a.text();case 8:if(s=e.sent,"error"!==(a=JSON.parse(s)).status){e.next=13;break}return console.error("[EnfaceApi.request] error response",s),e.abrupt("return",s);case 13:return e.abrupt("return",a);case 16:throw e.prev=16,e.t0=e.catch(5),console.error("[EnfaceApi.request] bad response",s),new Error("Bad response: ".concat(e.t0));case 20:case"end":return e.stop()}}),e,null,[[5,16]])})));return function(r){return e.apply(this,arguments)}}()),b(this,"_process",function(){var e=h(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t instanceof FormData?t.append("token",n.token):t=JSON.stringify(l(l({},t),{},{token:n.token})),e.next=4,n._request({uri:r,post:t});case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(0),console.error("[EnfaceApi.request] failed",e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,n){return e.apply(this,arguments)}}()),b(this,"_checkImages",function(){var e=h(regeneratorRuntime.mark((function e(r,n,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Array.isArray(r)||(r=[r]),e.next=4,c(r,n,t);case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(0),console.error("[EnfaceApi.checkImages]",e.t0),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,n,t){return e.apply(this,arguments)}}()),b(this,"detect",function(){var e=h(regeneratorRuntime.mark((function e(r){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._checkImages(r.images,1,10240);case 2:if(r.images=e.sent,r.images){e.next=5;break}return e.abrupt("return");case 5:return t=new FormData,r.bbox&&t.append("bbox","true"),r.bbox_pro&&t.append("bbox_pro","true"),r.multi&&t.append("multi","true"),r.feature_check&&r.feature_check.forEach((function(e){return t.append("feature_check",e)})),r.thumb&&t.append("thumb","true"),r.images.forEach((function(e,r){return t.append("images",e,"".concat(r,".jpg"))})),e.abrupt("return",n._process("/detect",t));case 13:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),b(this,"compare",function(){var e=h(regeneratorRuntime.mark((function e(r){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._checkImages(r.images,1,10240);case 2:if(r.images=e.sent,r.images){e.next=5;break}return e.abrupt("return");case 5:return t=new FormData,r.bbox&&t.append("bbox","true"),r.bbox_pro&&t.append("bbox_pro","true"),r.bbox_real&&t.append("bbox_real","true"),r.multi&&t.append("multi","true"),r.feature_check&&r.feature_check.forEach((function(e){return t.append("feature_check",e)})),r.thumb&&t.append("thumb","true"),r.threshold&&t.append("threshold",r.threshold),r.images.forEach((function(e,r){return t.append("images",e,"".concat(r,".jpg"))})),e.abrupt("return",n._process("/compare",t));case 15:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),b(this,"personSearch",function(){var e=h(regeneratorRuntime.mark((function e(r){var t,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._checkImages(r.image,1,10240);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:return o=f(t,1),r.image=o[0],a=new FormData,r.new_person_threshold&&a.append("new_person_threshold",r.new_person_threshold),r.new_person_square_min&&a.append("new_person_square_min",r.new_person_square_min),r.new_person_yaw_max&&a.append("new_person_yaw_max",r.new_person_yaw_max),r.person_list_search&&a.append("person_list_search",r.person_list_search),r.person_list_add&&a.append("person_list_add",r.person_list_add),r.group_id&&a.append("group_id",r.group_id),r.source_id&&a.append("source_id",r.source_id),r.thumb&&a.append("thumb","true"),r.bbox&&a.append("bbox","true"),r.bbox_pro&&a.append("bbox_pro","true"),r.multi&&a.append("multi","true"),r.feature_check&&r.feature_check.forEach((function(e){return a.append("feature_check",e)})),r.normalized&&a.append("normalized","true"),r.drop_image&&a.append("drop_image","true"),a.append("results",r.results||1),a.append("image",r.image,"0.jpg"),e.abrupt("return",n._process("/action",a));case 25:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),b(this,"personCreate",function(){var e=h(regeneratorRuntime.mark((function e(r){var t,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._checkImages(r.image,1,10240);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:return o=f(t,1),r.image=o[0],a=new FormData,r.new_person_threshold&&a.append("new_person_threshold",r.new_person_threshold),r.new_person_square_min&&a.append("new_person_square_min",r.new_person_square_min),r.new_person_yaw_max&&a.append("new_person_yaw_max",r.new_person_yaw_max),r.list_id&&a.append("list_id",r.list_id),r.replace_person_id&&a.append("replace_person_id",r.replace_person_id),r.fields&&r.fields.forEach((function(e){return a.append("fields",e)})),r.feature_check&&r.feature_check.forEach((function(e){return a.append("feature_check",e)})),r.multi&&a.append("multi","true"),r.normalized&&a.append("normalized","true"),r.drop_image&&a.append("drop_image","true"),r.bbox&&a.append("bbox","true"),r.bbox_pro&&a.append("bbox_pro","true"),r.thumb&&a.append("thumb","true"),a.append("image",r.image,"0.jpg"),e.abrupt("return",n._process("/person/create",a));case 23:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),b(this,"tokenCreate",(function(e){var r={};return e.valid_days&&(r.valid_days=e.valid_days),e.expires&&(r.expires=e.expires),n._process("/token/create",r)})),b(this,"tokenDelete",(function(e){return n._process("/token/delete",{token_id:e.token_id})})),b(this,"tokenUpdate",(function(e){var r={};return e.valid_days&&(r.valid_days=e.valid_days),e.expires&&(r.expires=e.expires),n._process("/token/update",l({token_id:e.token_id},r))})),b(this,"sourceGroupCreate",(function(e){var r={};return e.person_list_search&&(r.person_list_search=e.person_list_search),n._process("/source/group/create",l({name:e.name},r))})),b(this,"sourceGroupDelete",(function(e){return n._process("/source/group/delete",{group_id:e.group_id})})),b(this,"sourceGroupUpdate",(function(e){var r={};return e.name&&(r.name=e.name),e.person_list_search&&(r.person_list_search=e.person_list_search),n._process("/source/group/update",l({group_id:e.group_id},r))})),b(this,"sources",(function(e){return n._process("/sources",{group_id:e.group_id})})),b(this,"sourceCreate",(function(e){var r={};return e.new_person_threshold&&(r.new_person_threshold=e.new_person_threshold),e.new_person_square_min&&(r.new_person_square_min=e.new_person_square_min),e.new_person_yaw_max&&(r.new_person_yaw_max=e.new_person_yaw_max),e.person_list_add&&(r.person_list_add=e.person_list_add),e.feature_check&&(r.feature_check=e.feature_check),n._process("/source/create",l({group_id:e.group_id,name:e.name},r))})),b(this,"sourceDelete",(function(e){return n._process("/source/delete",{group_id:e.group_id,source_id:e.source_id})})),b(this,"sourceUpdate",(function(e){var r={};return e.name&&(r.name=e.name),e.new_person_threshold&&(r.new_person_threshold=e.new_person_threshold),e.new_person_square_min&&(r.new_person_square_min=e.new_person_square_min),e.new_person_yaw_max&&(r.new_person_yaw_max=e.new_person_yaw_max),e.person_list_add&&(r.person_list_add=e.person_list_add),e.feature_check&&(r.feature_check=e.feature_check),n._process("/source/update",l({group_id:e.name,source_id:e.source_id},r))})),b(this,"person",(function(e){return n._process("/person",{list_id:e.list_id,person_id:e.person_id})})),b(this,"personLists",(function(){return n._process("/person/lists",{})})),b(this,"personListCreate",(function(e){return n._process("/person/list/create",{name:e.name})})),b(this,"personListDelete",(function(e){var r={};return e.list_id&&(r.list_id=e.list_id),e.name&&(r.name=e.name),n._process("/person/list/delete",l({},r))})),b(this,"personListUpdate",(function(e){return n._process("/person/list/update",{list_id:e.list_id,name:e.name})})),b(this,"personDelete",(function(e){var r={};return e.list_id&&(r.list_id=e.list_id),n._process("/person/delete",l({person_id:e.person_id},r))})),b(this,"personUpdate",(function(e){var r={};return e.list_id&&(r.list_id=e.list_id),e.fields&&(r.fields=e.fields),e.drop_image&&(r.drop_image=e.drop_image),n._process("/person/update",l({person_id:e.person_id},r))})),b(this,"facesOnImageCount",function(){var e=h(regeneratorRuntime.mark((function e(r){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.apiDetect({images:r.images,bbox:!0,multi:!0});case 2:return t=e.sent,e.abrupt("return",t.results&&Array.isArray(t.results)&&Array.isArray(t.results[0])?t.results[0].length:0);case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),b(this,"guaranteed",function(){var e=h(regeneratorRuntime.mark((function e(r,n){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=null;case 1:return e.prev=1,e.next=4,r(n);case 4:t=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),e.next=11,p(2e3);case 11:if(null===t){e.next=1;break}case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(r,n){return e.apply(this,arguments)}}()),this.apiUrl=t,this.token=o},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.version,n=void 0===r?o[o.length-1]:r,t=e.token,s=e.url;if(!u(t))throw new Error("Bad API key format");if(!s){if(n=+n,!o.includes(n))throw new Error("You have specified a non-existent version of Enface API: ".concat(n,". Available versions: ").concat(o.join(", ")));s=a["v".concat(n)].https}return new g({token:t,apiUrl:s})};s||(window.createEnfaceApi=y);var w=y}])}));